<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌿 Alquidermis - Test Personalizado de Piel</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQWxxdWlkZXJtaXMgLSBUZXN0IFBlcnNvbmFsaXphZG8iLCJzaG9ydF9uYW1lIjoiQWxxdWlkZXJtaXMiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2E4ZTZjZiIsInRoZW1lX2NvbG9yIjoiIzJkNTAxNiJ9">
    <meta name="theme-color" content="#2d5016">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Alquidermis">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Test personalizado de piel con Pepi Jiménez. Descubre productos naturales perfectos para tu tipo de piel. Consulta gratuita en 24-48h.">
    <meta name="keywords" content="test piel, cosmética natural, Alquidermis, Pepi Jiménez, productos naturales, rutina facial">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 50%, #ffd3a5 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: #fff;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
            padding: 30px 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: float 20s linear infinite;
        }

        @keyframes float {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(-30px, -30px) rotate(360deg); }
        }

        .logo {
            font-size: 32px;
            color: #2d5016;
            font-weight: bold;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .tagline {
            color: #2d5016;
            font-size: 16px;
            opacity: 0.9;
            position: relative;
            z-index: 2;
            font-weight: 500;
        }

        .main-content {
            padding: 0;
            position: relative;
        }

        .screen {
            display: none;
            padding: 30px 25px;
            min-height: calc(100vh - 120px);
        }

        .screen.active {
            display: block;
            animation: fadeInSlide 0.5s ease-out;
        }

        @keyframes fadeInSlide {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .welcome-title {
            font-size: 26px;
            color: #2d5016;
            margin-bottom: 20px;
            font-weight: bold;
            text-align: center;
            line-height: 1.3;
        }

        .welcome-text {
            color: #555;
            font-size: 16px;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.7;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
            margin: 30px 0;
        }

        .benefit-card {
            background: linear-gradient(135deg, #fff 0%, #f8fffe 100%);
            padding: 25px 15px;
            border-radius: 16px;
            text-align: center;
            border: 2px solid #e8f5e8;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .benefit-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(168, 230, 207, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .benefit-card:hover::before {
            left: 100%;
        }

        .benefit-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 30px rgba(168, 230, 207, 0.4);
            border-color: #a8e6cf;
        }

        .benefit-icon {
            font-size: 36px;
            margin-bottom: 12px;
            display: block;
        }

        .benefit-title {
            font-size: 15px;
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .benefit-desc {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .cta-section {
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            margin: 30px 0;
            position: relative;
            overflow: hidden;
        }

        .cta-section::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ffd3a5, #fd9853, #a8e6cf, #88d8a3);
            border-radius: 22px;
            z-index: -1;
            opacity: 0.7;
            animation: borderFlow 4s ease-in-out infinite alternate;
        }

        @keyframes borderFlow {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.02) rotate(2deg); }
        }

        .cta-title {
            color: #2d5016;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            line-height: 1.3;
        }

        .cta-subtitle {
            color: #2d5016;
            font-size: 14px;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .start-test-btn, .primary-btn {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%);
            color: white;
            border: none;
            padding: 16px 35px;
            border-radius: 30px;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(45, 80, 22, 0.3);
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 280px;
        }

        .start-test-btn::before, .primary-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .start-test-btn:hover::before, .primary-btn:hover::before {
            left: 100%;
        }

        .start-test-btn:hover, .primary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(45, 80, 22, 0.4);
        }

        .start-test-btn:active, .primary-btn:active {
            transform: translateY(-1px);
        }

        .stats-section {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            padding: 25px 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 18px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-number {
            font-size: 18px;
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 11px;
            color: #666;
            line-height: 1.3;
        }

        .progress-bar {
            height: 8px;
            background: #e8f0e8;
            border-radius: 4px;
            margin: 20px 0 30px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
            border-radius: 4px;
            transition: width 0.4s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            color: #2d5016;
            font-weight: bold;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .question-title {
            font-size: 20px;
            color: #2d5016;
            margin-bottom: 25px;
            font-weight: bold;
            line-height: 1.4;
        }

        .options-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-card {
            background: white;
            border: 2px solid #e8f5e8;
            border-radius: 14px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .option-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(168, 230, 207, 0.2), transparent);
            transition: left 0.4s ease;
        }

        .option-card:hover::before {
            left: 100%;
        }

        .option-card:hover {
            border-color: #a8e6cf;
            background: #f8fffe;
            transform: translateX(8px);
            box-shadow: 0 5px 15px rgba(168, 230, 207, 0.2);
        }

        .option-card.selected {
            border-color: #2d5016;
            background: linear-gradient(135deg, #f0fdf4 0%, #e8f5e8 100%);
            transform: translateX(8px);
            box-shadow: 0 8px 20px rgba(45, 80, 22, 0.2);
        }

        .option-title {
            font-weight: bold;
            color: #2d5016;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .option-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .next-btn {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            width: 100%;
            font-size: 16px;
            opacity: 0.5;
            transition: all 0.3s ease;
            position: relative;
        }

        .next-btn.enabled {
            opacity: 1;
            box-shadow: 0 8px 20px rgba(45, 80, 22, 0.3);
        }

        .next-btn.enabled:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(45, 80, 22, 0.4);
        }

        .result-icon {
            font-size: 80px;
            margin-bottom: 25px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-15px); }
            60% { transform: translateY(-8px); }
        }

        .result-title {
            font-size: 28px;
            color: #2d5016;
            margin-bottom: 20px;
            font-weight: bold;
            line-height: 1.3;
        }

        .result-desc {
            color: #666;
            line-height: 1.7;
            margin-bottom: 35px;
            font-size: 16px;
        }

        .pepi-info {
            background: linear-gradient(135deg, #fff 0%, #f8fffe 100%);
            border: 2px solid #a8e6cf;
            border-radius: 18px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
            overflow: hidden;
        }

        .pepi-info::before {
            content: '';
            position: absolute;
            top: -1px;
            left: -1px;
            right: -1px;
            bottom: -1px;
            background: linear-gradient(45deg, #a8e6cf, #88d8a3, #a8e6cf);
            border-radius: 19px;
            z-index: -1;
            animation: borderRotate 3s linear infinite;
        }

        @keyframes borderRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .pepi-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #a8e6cf 0%, #88d8a3 100%);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            box-shadow: 0 8px 20px rgba(168, 230, 207, 0.4);
        }

        .contact-form {
            background: white;
            border-radius: 18px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border: 1px solid #e8f5e8;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-label {
            display: block;
            color: #2d5016;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e8f5e8;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #a8e6cf;
            box-shadow: 0 0 0 3px rgba(168, 230, 207, 0.2);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            text-align: center;
        }

        .disclaimer-icon {
            font-size: 28px;
            color: #f39c12;
            margin-bottom: 12px;
        }

        .disclaimer-text {
            font-size: 13px;
            color: #856404;
            line-height: 1.6;
        }

        .success-message {
            display: none;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border: 2px solid #a8e6cf;
            border-radius: 18px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            color: #155724;
            animation: successPulse 0.6s ease-out;
        }

        @keyframes successPulse {
            0% { transform: scale(0.9); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .install-banner {
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%);
            color: white;
            padding: 12px 20px;
            text-align: center;
            display: none;
            font-size: 14px;
            cursor: pointer;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .install-banner.show {
            display: block;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .loading-spinner {
            display: none;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
                max-width: 100%;
            }
            
            .header {
                padding: 25px 20px;
            }
            
            .screen {
                padding: 25px 20px;
            }
            
            .welcome-title {
                font-size: 24px;
            }
            
            .benefits-grid {
                gap: 15px;
            }
            
            .benefit-card {
                padding: 20px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Banner de instalación PWA -->
    <div id="install-banner" class="install-banner">
        📱 ¡Instala la app para una mejor experiencia! <strong>Toca aquí</strong>
    </div>

    <div class="container">
        <div class="header">
            <div class="logo">🌿 ALQUIDERMIS</div>
            <div class="tagline">¡Para Sentirse Libre!</div>
        </div>

        <div class="main-content">
            <!-- Pantalla de Bienvenida -->
            <div id="welcome-screen" class="screen active">
                <div class="disclaimer">
                    <div class="disclaimer-icon">⚠️</div>
                    <div class="disclaimer-text">
                        <strong>Importante:</strong> Esta app es solo para seguimiento personal y educativo. 
                        Siempre consulta con un dermatólogo para cualquier preocupación médica.
                    </div>
                </div>

                <h1 class="welcome-title">¿Qué necesita realmente tu piel?</h1>
                <p class="welcome-text">
                    Descubre en solo 2 minutos qué productos naturales son perfectos para tu tipo de piel. 
                    Nuestro test personalizado te conectará con <strong>Pepi Jiménez</strong>, experta en cosmética natural artesanal.
                </p>

                <div class="benefits-grid">
                    <div class="benefit-card">
                        <span class="benefit-icon">🎯</span>
                        <div class="benefit-title">Análisis personalizado</div>
                        <div class="benefit-desc">de tu tipo de piel único</div>
                    </div>

                    <div class="benefit-card">
                        <span class="benefit-icon">👩‍⚕️</span>
                        <div class="benefit-title">Consulta con experta</div>
                        <div class="benefit-desc">Pepi Jiménez</div>
                    </div>

                    <div class="benefit-card">
                        <span class="benefit-icon">🌿</span>
                        <div class="benefit-title">Productos 100%</div>
                        <div class="benefit-desc">naturales</div>
                    </div>

                    <div class="benefit-card">
                        <span class="benefit-icon">💰</span>
                        <div class="benefit-title">Descuento del 10%</div>
                        <div class="benefit-desc">incluido</div>
                    </div>
                </div>

                <div class="cta-section">
                    <h2 class="cta-title">¡Empieza tu consulta GRATUITA ahora!</h2>
                    <p class="cta-subtitle">Solo 7 preguntas • 2 minutos • Respuesta en 24-48h</p>
                    <button class="start-test-btn" onclick="startTest()">
                        🚀 Comenzar Test Personalizado
                    </button>
                </div>

                <div class="stats-section">
                    <div class="stat-item">
                        <div class="stat-number">⭐ +500</div>
                        <div class="stat-label">consultas realizadas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">🔒 100%</div>
                        <div class="stat-label">datos seguros</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">📞 24-48h</div>
                        <div class="stat-label">respuesta garantizada</div>
                    </div>
                </div>
            </div>

            <!-- Pantalla del Test -->
            <div id="test-screen" class="screen">
                <div class="progress-text">Pregunta <span id="question-number">1</span> de 7</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 14.28%"></div>
                </div>
                
                <div id="question-content"></div>
                
                <button class="next-btn" id="next-btn" onclick="nextQuestion()">
                    Siguiente Pregunta →
                </button>
            </div>

            <!-- Pantalla de Resultados -->
            <div id="result-screen" class="screen">
                <div style="text-align: center;">
                    <div class="result-icon">✨</div>
                    <h2 class="result-title">¡Tu Rutina Personalizada Está Lista!</h2>
                    <p class="result-desc">
                        Descubre los productos perfectos para tu piel única con la consulta personalizada de nuestra experta.
                    </p>
                </div>

                <div class="pepi-info">
                    <div class="pepi-avatar">👩‍⚕️</div>
                    <h3 style="color: #2d5016; margin-bottom: 15px; text-align: center; font-size: 18px;">
                        💌 Consulta Personalizada con Pepi Jiménez
                    </h3>
                    <div style="font-size: 13px; color: #666; line-height: 1.6;">
                        <strong>Nuestra experta formuladora te enviará:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li>✅ Análisis detallado de tu tipo de piel único</li>
                            <li>✅ Rutina personalizada paso a paso</li>
                            <li>✅ Recomendaciones específicas de productos artesanales</li>
                            <li>✅ Consejos de aplicación profesionales</li>
                            <li>✅ Descuento exclusivo del 10% en tu primer pedido</li>
                        </ul>
                    </div>
                </div>

                <div id="success-message" class="success-message">
                    <h3>🎉 ¡Test Enviado Exitosamente!</h3>
                    <p>Tu consulta personalizada llegará a tu email en 24-48 horas.</p>
                    <p><strong>¡Gracias por confiar en Alquidermis!</strong> 🌿</p>
                </div>

                <!-- Formulario Real con Formspree -->
                <form class="contact-form" id="contact-form" action="https://formspree.io/f/xdkogpan" method="POST">
                    <h4 style="color: #2d5016; margin-bottom: 20px; text-align: center; font-size: 18px;">
                        Recibe tu consulta personalizada
                    </h4>
                    
                    <div class="form-group">
                        <label class="form-label" for="name">Nombre completo *</label>
                        <input type="text" class="form-input" id="name" name="name" placeholder="Tu nombre completo" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="email">Email *</label>
                        <input type="email" class="form-input" id="email" name="email" placeholder="tu@email.com" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="phone">Teléfono (opcional)</label>
                        <input type="tel" class="form-input" id="phone" name="phone" placeholder="+34 600 000 000">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="additional-info">¿Algo más que quieras contarnos sobre tu piel? (opcional)</label>
                        <textarea class="form-textarea" id="additional-info" name="additional-info" placeholder="Ej: Tengo la piel muy sensible, uso productos específicos, etc."></textarea>
                    </div>

                    <!-- Campos ocultos con las respuestas del test -->
                    <input type="hidden" id="test-answers" name="test-answers">
                    <input type="hidden" id="test-summary" name="test-summary">
                    <input type="hidden" name="_subject" value="Nueva consulta personalizada de piel - Alquidermis">

                    <button type="submit" class="primary-btn" id="submit-btn">
                        <span id="submit-text">💌 Enviar y Recibir Consulta Gratuita</span>
                        <div id="loading-spinner" class="loading-spinner"></div>
                    </button>

                    <p style="font-size: 12px; color: #999; text-align: center; margin-top: 15px; line-height: 1.5;">
                        📞 Respuesta garantizada en 24-48h | 🔒 Datos 100% seguros<br>
                        Al enviar aceptas recibir comunicaciones de Alquidermis
                    </p>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Configuración del test
        const questions = [
            {
                title: "¿Cómo describirías tu tipo de piel generalmente?",
                options: [
                    { title: "Piel Grasa", desc: "Brillos frecuentes, poros dilatados, tendencia al acné" },
                    { title: "Piel Seca", desc: "Sensación de tirantez, descamación, falta de luminosidad" },
                    { title: "Piel Mixta", desc: "Zona T grasa (frente, nariz, mentón), mejillas normales o secas" },
                    { title: "Piel Sensible", desc: "Reacciones frecuentes, enrojecimiento, irritación fácil" }
                ]
            },
            {
                title: "¿Cuál es tu principal preocupación actual con tu piel?",
                options: [
                    { title: "Acné y granitos", desc: "Brotes frecuentes, puntos negros, marcas de acné" },
                    { title: "Manchas y pigmentación", desc: "Melasma, manchas de edad, hiperpigmentación" },
                    { title: "Líneas de expresión y arrugas", desc: "Signos de edad, pérdida de firmeza, flacidez" },
                    { title: "Rojeces y rosácea", desc: "Enrojecimiento persistente, capilares visibles, irritación" }
                ]
            },
            {
                title: "¿Cómo reacciona tu piel cuando pruebas productos nuevos?",
                options: [
                    { title: "Muy bien, sin problemas", desc: "Rara vez tengo reacciones adversas" },
                    { title: "Normalmente bien", desc: "Ocasionalmente algo de sensibilidad inicial" },
                    { title: "Con cuidado", desc: "Necesito probar antes en una pequeña zona" },
                    { title: "Muy sensible", desc: "Frecuentes reacciones, alergias o irritaciones" }
                ]
            },
            {
                title: "¿Cuántos pasos prefieres en tu rutina diaria de cuidado?",
                options: [
                    { title: "Rutina mínima (1-2 productos)", desc: "Busco simplicidad y máxima eficacia" },
                    { title: "Rutina básica (3-4 productos)", desc: "Equilibrio perfecto sin complicaciones" },
                    { title: "Rutina completa (5+ productos)", desc: "Me encanta cuidarme con un ritual detallado" }
                ]
            },
            {
                title: "¿Cómo te sientes usando aceites naturales en tu piel?",
                options: [
                    { title: "Me encantan los aceites", desc: "Disfruto la nutrición profunda y el tacto sedoso natural" },
                    { title: "Tengo dudas sobre los aceites", desc: "Me preocupa que dejen sensación grasa o pesada" },
                    { title: "Nunca he probado aceites faciales", desc: "Me da curiosidad pero no sé si son para mí" },
                    { title: "He tenido malas experiencias", desc: "Los aceites que probé me dieron granitos o no me gustaron" }
                ]
            },
            {
                title: "¿Cuál es tu momento favorito para cuidar tu piel?",
                options: [
                    { title: "Por la mañana", desc: "Me da energía y protección para afrontar el día" },
                    { title: "Por la noche", desc: "Mi ritual relajante de autocuidado antes de dormir" },
                    { title: "Mañana y noche", desc: "Rutina completa adaptada a cada momento" },
                    { title: "Fines de semana", desc: "Tratamientos intensivos cuando tengo más tiempo" }
                ]
            },
            {
                title: "¿Qué te atrae más de la cosmética natural artesanal?",
                options: [
                    { title: "Ingredientes puros y naturales", desc: "Sin químicos agresivos, parabenos ni tóxicos" },
                    { title: "Resultados reales y duraderos", desc: "Mejora auténtica y sostenible de la piel" },
                    { title: "Valores conscientes", desc: "Sostenibilidad, respeto al medio ambiente y ética" },
                    { title: "Elaboración artesanal única", desc: "Productos exclusivos hechos con cariño y dedicación" }
                ]
            }
        ];

        // Variables globales
        let currentQuestion = 0;
        let answers = [];

        // PWA Installation
        let deferredPrompt;
        const installBanner = document.getElementById('install-banner');

        // Eventos de instalación PWA
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBanner.classList.add('show');
        });

        installBanner.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                installBanner.classList.remove('show');
            }
        });

        // Funciones del test
        function startTest() {
            showScreen('test-screen');
            showQuestion(0);

            // Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'test_started', {
                    event_category: 'engagement',
                    event_label: 'skin_test'
                });
            }
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showQuestion(index) {
            const question = questions[index];
            const progress = ((index + 1) / questions.length) * 100;
            
            document.getElementById('question-number').textContent = index + 1;
            document.getElementById('progress-fill').style.width = progress + '%';
            
            const questionContent = document.getElementById('question-content');
            questionContent.innerHTML = `
                <div class="question-title">${index + 1}. ${question.title}</div>
                <div class="options-grid">
                    ${question.options.map((option, i) => `
                        <div class="option-card" onclick="selectOption(${i})" data-option="${i}">
                            <div class="option-title">${option.title}</div>
                            <div class="option-desc">${option.desc}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('next-btn').classList.remove('enabled');
            
            // Restaurar selección previa si existe
            if (answers[index] !== undefined) {
                selectOption(answers[index]);
            }
        }

        function selectOption(optionIndex) {
            // Remover selección previa
            document.querySelectorAll('.option-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Seleccionar nueva opción
            document.querySelector(`[data-option="${optionIndex}"]`).classList.add('selected');
            answers[currentQuestion] = optionIndex;
            
            // Habilitar botón siguiente
            const nextBtn = document.getElementById('next-btn');
            nextBtn.classList.add('enabled');
            
            if (currentQuestion === questions.length - 1) {
                nextBtn.innerHTML = 'Ver Resultados ✨';
            }
        }

        function nextQuestion() {
            const nextBtn = document.getElementById('next-btn');
            if (!nextBtn.classList.contains('enabled')) return;
            
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            } else {
                showResults();
            }
        }

        function showResults() {
            showScreen('result-screen');
            prepareFormData();

            // Analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'test_completed', {
                    event_category: 'conversion',
                    event_label: 'skin_test'
                });
            }
        }

        function prepareFormData() {
            // Preparar resumen de respuestas
            const answersData = answers.map((answerIndex, questionIndex) => {
                const question = questions[questionIndex];
                const selectedOption = question.options[answerIndex];
                return {
                    question: `${questionIndex + 1}. ${question.title}`,
                    answer: selectedOption.title,
                    description: selectedOption.desc
                };
            });

            // JSON para procesamiento
            document.getElementById('test-answers').value = JSON.stringify(answersData);
            
            // Resumen legible para el email
            const summary = `CONSULTA PERSONALIZADA DE PIEL - ALQUIDERMIS

Fecha: ${new Date().toLocaleDateString('es-ES')}
Hora: ${new Date().toLocaleTimeString('es-ES')}

=== RESPUESTAS DEL TEST ===

${answersData.map((item, index) => 
    `${item.question}
Respuesta: ${item.answer}
Descripción: ${item.description}
`).join('\n')}

=== RESUMEN PARA PEPI ===
Este cliente ha completado el test personalizado de piel y está esperando su consulta experta.
Por favor, analiza las respuestas y envía recomendaciones personalizadas dentro de 24-48h.

¡Gracias por hacer que cada cliente se sienta libre con su piel! 🌿
`;
            
            document.getElementById('test-summary').value = summary;
        }

        // Manejo del formulario
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submit-btn');
            const submitText = document.getElementById('submit-text');
            const loadingSpinner = document.getElementById('loading-spinner');
            const successMessage = document.getElementById('success-message');
            
            // Mostrar loading
            submitText.style.display = 'none';
            loadingSpinner.style.display = 'block';
            submitBtn.disabled = true;
            
            // Preparar datos del formulario
            const formData = new FormData(this);
            
            // Enviar a Formspree
            fetch('https://formspree.io/f/xdkogpan', {
                method: 'POST',
                body: formData,
                headers: {
                    'Accept': 'application/json'
                }
            })
            .then(response => {
                if (response.ok) {
                    // Éxito
                    this.style.display = 'none';
                    successMessage.style.display = 'block';
                    
                    // Scroll al mensaje de éxito
                    successMessage.scrollIntoView({ behavior: 'smooth' });
                    
                    // Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'form_submit', {
                            event_category: 'conversion',
                            event_label: 'skin_test_lead'
                        });
                    }
                } else {
                    throw new Error('Error en el envío');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un error al enviar tu consulta. Por favor, inténtalo de nuevo o contacta directamente con Alquidermis.');
                
                // Restaurar botón
                submitText.style.display = 'inline';
                loadingSpinner.style.display = 'none';
                submitBtn.disabled = false;
            });
        });

        // Funciones de utilidad
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🌿 Alquidermis Test App cargada correctamente');
            
            // Precargar siguiente pregunta
            if (questions.length > 1) {
                setTimeout(() => {
                    // Precargar imágenes o contenido si fuera necesario
                }, 1000);
            }
        });

        // Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'alquidermis-v2';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    return response || fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('SW registered:', registration))
                    .catch(error => console.log('SW registration failed:', error));
            });
        }
    </script>
</body>
</html>
